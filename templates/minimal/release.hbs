<div class="container">
  <nav class="breadcrumb">
    <a href="{{path backUrl}}">← Back to catalog</a>
  </nav>

  <article class="release-detail">
    <header class="release-header">
      {{#if release.coverUrl}}
      <div class="release-cover-large">
        <img src="{{path release.coverUrl}}" alt="{{release.config.title}}">
      </div>
      {{/if}}
      
      <div class="release-metadata">
        <h1>{{release.config.title}}</h1>
        
        {{#if artist}}
        <p class="release-artist">by {{artist.name}}</p>
        {{/if}}
        
        <p class="release-date">Released {{formatDate release.config.date}}</p>
        
        {{#if release.config.genres}}
        <div class="release-genres">
          {{#each release.config.genres}}
          <span class="genre-tag">{{this}}</span>
          {{/each}}
        </div>
        {{/if}}
        
        {{#if release.config.description}}
        <p class="release-description">{{release.config.description}}</p>
        {{/if}}
        
        {{#if release.config.credits}}
        <div class="release-credits">
          <h3>Credits</h3>
          <ul>
            {{#each release.config.credits}}
            <li><strong>{{role}}:</strong> {{name}}</li>
            {{/each}}
          </ul>
        </div>
        {{/if}}
        
        {{#if release.config.download}}
        <div class="release-download-actions">
          {{#if (eq release.config.download "free")}}
          <button class="btn btn-primary" onclick="downloadAll()">
            <i class="fas fa-download"></i> Download All (Free)
          </button>
          {{else if (eq release.config.download "paycurtain")}}
          <div class="paycurtain">
            <p>Suggested price: ${{release.config.price}}</p>
            <button class="btn btn-primary">
              <i class="fas fa-dollar-sign"></i> Pay What You Want
            </button>
          </div>
          {{else if (eq release.config.download "codes")}}
          <div class="download-codes">
            <input type="text" placeholder="Enter download code" class="code-input">
            <button class="btn btn-primary">
              <i class="fas fa-unlock"></i> Unlock
            </button>
          </div>
          {{/if}}
        </div>
        {{/if}}
      </div>
    </header>
    
    <section class="tracklist">
      <h2>Tracks</h2>
      
      <div class="audio-player" id="audioPlayer">
        <div class="player-track-info">
          <div class="player-cover">
            {{#if release.coverUrl}}
            <img src="{{release.coverUrl}}" alt="{{release.config.title}}" id="playerCover">
            {{else}}
            <i class="fas fa-music"></i>
            {{/if}}
          </div>
          <div class="player-details">
            <div class="player-title" id="playerTitle">Select a track</div>
            <div class="player-artist" id="playerArtist">{{#if artist}}{{artist.name}}{{/if}}</div>
          </div>
        </div>
        
        <div class="player-controls">
          <button class="player-btn" id="prevBtn"><i class="fas fa-step-backward"></i></button>
          <button class="player-btn player-btn-play" id="playBtn">
            <i class="fas fa-play"></i>
          </button>
          <button class="player-btn" id="nextBtn"><i class="fas fa-step-forward"></i></button>
        </div>
        
        <div class="player-progress">
          <span class="player-time" id="currentTime">0:00</span>
          <input type="range" class="progress-bar" id="progressBar" min="0" max="100" value="0">
          <span class="player-time" id="duration">0:00</span>
        </div>
        
        <div class="player-volume">
          <i class="fas fa-volume-up"></i>
          <input type="range" class="volume-bar" id="volumeBar" min="0" max="100" value="80">
        </div>
      </div>
      
      <ol class="track-list">
        {{#each release.tracks}}
        <li class="track-item" data-src="{{releasePath url}}" data-index="{{@index}}">
          <div class="track-number">{{@index}}</div>
          <div class="track-info">
            <div class="track-title">{{title}}</div>
            <div class="track-meta">
              {{formatAudioFormat filename}}
              {{#if duration}}
              · {{formatDuration duration}}
              {{/if}}
            </div>
          </div>
          <div class="track-actions">
            <button class="track-play-btn" onclick="playTrack({{@index}})">
              <i class="fas fa-play"></i>
            </button>
            {{#if ../release.config.download}}
            {{#if (eq ../release.config.download "free")}}
            <a href="{{releasePath url}}" download class="track-download-btn">
              <i class="fas fa-download"></i>
            </a>
            {{/if}}
            {{/if}}
          </div>
        </li>
        {{/each}}
      </ol>
    </section>
  </article>
</div>

<script>
  // Initialize player with tracks
  window.tracks = [
    {{#each release.tracks}}
    {
      url: '{{releasePath url}}',
      title: '{{title}}',
      artist: '{{#if artist}}{{artist}}{{else}}{{../artist.name}}{{/if}}',
      duration: {{#if duration}}{{duration}}{{else}}0{{/if}}
    }{{#unless @last}},{{/unless}}
    {{/each}}
  ];
</script>

